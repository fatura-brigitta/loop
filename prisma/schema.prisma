
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output = "../app/prisma/client"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

model Admin {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  password_hash String

  @@map("admins")
}

model Movie {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  director      String
  actors        String
  playtime      Int
  language      String
  trailer       String
  poster        String
  onscreen      Boolean
  genre         String
  review        Float?
  description   String?

  screenings    Screening[]
  forum         Forum[]
  @@map("movies")
}

model Screening {
  id                String @id @default(auto()) @map("_id") @db.ObjectId
  hall_id           String @db.ObjectId
  movie_id          String @db.ObjectId
  start             DateTime
  end               DateTime
  screening_type_id String @db.ObjectId

  movies            Movie?   @relation(fields: [movie_id], references: [id], onDelete: Cascade)
  halls             Hall?   @relation(fields: [hall_id], references: [id], onDelete: Cascade)
  screening_types   Screening_type?   @relation(fields: [screening_type_id], references: [id], onDelete: Cascade)
  @@map("screenings")
}

model User {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String @unique
  password_hash String
  phone_number  String @unique
  points        Int
  rank_id       String @db.ObjectId

  ranks         Rank?         @relation(fields: [rank_id], references: [id], onDelete: Cascade)

  tickets       Ticket[]
  forum         Forum[]
  @@map("users")
}

model Chair {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  state       Boolean @default(false)
  row         Int
  column      Int
  hall_id     String @db.ObjectId

  halls       Hall?   @relation(fields: [hall_id], references: [id], onDelete: Cascade)
  @@map("chairs")
}

model Rank {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  name          String @unique
  point_limit   String
  discount_id   String @db.ObjectId
  image         String

  discount      Discount?  @relation(fields: [discount_id], references: [id], onDelete: Cascade)
  users User[]
  @@map("ranks")
}

model Discount {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  name          String 
  image         String
  percent       Int

  ranks Rank[]
  @@map("discounts")
}

model Hall {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  row           Int
  column        Int

  screenings    Screening[]
  chairs        Chair[]
  @@map("halls")
}

model Forum {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  review        Float
  comment       String
  user_id       String @db.ObjectId
  movie_id      String @db.ObjectId

  users         User?   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  movies        Movie?   @relation(fields: [movie_id], references: [id], onDelete: Cascade)
  @@map("forums")
}

model Ticket {
  id             String @id @default(auto()) @map("_id") @db.ObjectId
  ticket_type_id String @db.ObjectId
  user_id        String @db.ObjectId
  screening_id   String @db.ObjectId

  ticket_types    Ticket_type?  @relation(fields: [ticket_type_id], references: [id], onDelete: Cascade)
  screening_types Screening_type?  @relation(fields: [screening_id], references: [id], onDelete: Cascade)
  users User?  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  @@map("tickets")
}

model Ticket_type {
  id             String @id @default(auto()) @map("_id") @db.ObjectId
  type           String
  percent        Int

  tickets Ticket[]
  @@map("ticket_types")
}

model Screening_type {
  id             String @id @default(auto()) @map("_id") @db.ObjectId
  type           String
  percent        Int

  tickets Ticket[]
  screenings Screening[]
  @@map("screening_types")
}